<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Swatchy - A suite of color tools for Ohuhu markers">
  <title>{% block title %}Swatchy{% endblock %}</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Comfortaa:wght@400;500;600;700&display=swap');
    body { font-family: 'Poppins', sans-serif; }
    .font-comfortaa { font-family: 'Comfortaa', sans-serif; }
    .gradient-bg {
      background: linear-gradient(135deg, #fdf4ff 0%, #fff1f2 25%, #fff7ed 50%, #f0fdf4 75%, #ecfeff 100%);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }
    .tool-icon {
      background: linear-gradient(135deg, #d946ef 0%, #f43f5e 50%, #f97316 100%);
    }
  </style>
  {% block extra_css %}{% endblock %}
</head>
<body class="gradient-bg min-h-screen">
  <!-- Navigation -->
  <nav class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <a href="/" class="flex items-center gap-2 group">
          <img src="{{ url_for('static', filename='images/swatchy_logo.png') }}" alt="Swatchy" class="h-12 w-auto object-contain rounded-lg">
          <span class="font-comfortaa text-2xl text-gray-800">Swatchy</span>
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center gap-1">
          <a href="/color-wheel" class="px-4 py-2 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Color Wheel</a>
          <a href="/palette-generator" class="px-4 py-2 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Palette Generator</a>
          <a href="/theme-library" class="px-4 py-2 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Theme Library</a>
          <a href="/image-picker" class="px-4 py-2 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Image Picker</a>
          <a href="/color-picker" class="px-4 py-2 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Color Picker</a>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div id="mobileMenu" class="hidden md:hidden pb-4">
        <div class="flex flex-col gap-1">
          <a href="/color-wheel" class="px-4 py-3 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Color Wheel</a>
          <a href="/palette-generator" class="px-4 py-3 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Palette Generator</a>
          <a href="/theme-library" class="px-4 py-3 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Theme Library</a>
          <a href="/image-picker" class="px-4 py-3 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Image Picker</a>
          <a href="/color-picker" class="px-4 py-3 rounded-lg text-gray-600 hover:text-primary-600 hover:bg-primary-50 transition-colors text-sm font-medium">Color Picker</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 bg-white/50 mt-auto">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <p class="text-sm text-gray-500">Swatchy - Color tools for Ohuhu markers</p>
        <div class="flex items-center gap-4">
          <span class="text-xs text-gray-400">540+ marker colors</span>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    document.getElementById('mobileMenuBtn').addEventListener('click', () => {
      document.getElementById('mobileMenu').classList.toggle('hidden');
    });

    // Shared color utilities
    function hexToHSV(hex) {
      hex = hex.replace(/^#/, '');
      const r = parseInt(hex.slice(0, 2), 16) / 255;
      const g = parseInt(hex.slice(2, 4), 16) / 255;
      const b = parseInt(hex.slice(4, 6), 16) / 255;

      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      const diff = max - min;

      let h = 0;
      let s = max === 0 ? 0 : diff / max;
      let v = max;

      if (diff !== 0) {
        switch (max) {
          case r: h = 60 * (((g - b) / diff) % 6); break;
          case g: h = 60 * ((b - r) / diff + 2); break;
          case b: h = 60 * ((r - g) / diff + 4); break;
        }
      }

      h = h < 0 ? h + 360 : h;
      return { h, s: s * 100, v: v * 100 };
    }

    function calculateBrightness(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return (r * 299 + g * 587 + b * 114) / 1000;
    }

    function getTextColor(hex) {
      return calculateBrightness(hex) > 128 ? '#000' : '#fff';
    }

    // Generate tags for a marker based on HSV values
    function generateTags(marker) {
      const tags = [];
      const { h, s, v } = marker.hsv;

      // Normalize s and v to 0-1 range for easier comparison
      const sat = s / 100;
      const val = v / 100;

      // Temperature (from hue and saturation)
      if (sat < 0.1) {
        tags.push('neutral');
      } else if (h >= 330 || h < 60) {
        tags.push('warm');
      } else if (h >= 60 && h < 300) {
        tags.push('cool');
      }

      // Saturation levels
      if (sat < 0.3) {
        tags.push('muted');
      } else if (sat > 0.7) {
        tags.push('vibrant');
      } else {
        tags.push('bright');
      }

      // Value/Brightness levels
      if (val > 0.7) {
        tags.push('light');
      } else if (val < 0.3) {
        tags.push('dark');
      } else {
        tags.push('medium');
      }

      // Base hue categories
      if (sat >= 0.1) {
        if (h >= 330 || h < 30) tags.push('red');
        else if (h >= 30 && h < 50) tags.push('orange');
        else if (h >= 50 && h < 70) tags.push('yellow');
        else if (h >= 70 && h < 150) tags.push('green');
        else if (h >= 150 && h < 200) tags.push('cyan');
        else if (h >= 200 && h < 260) tags.push('blue');
        else if (h >= 260 && h < 300) tags.push('purple');
        else if (h >= 300 && h < 330) tags.push('pink');
      }

      // Special tags based on color name patterns
      const nameLower = marker.name.toLowerCase();

      // Skin tones - peach to deep brown range
      const skinToneNames = [
        'barely blush', 'pastel blush', 'peachy blush', 'peach cobbler',
        'warm beige', 'eggshell brown', 'unbleached titanium', 'orange sorbet',
        'sandy beige', 'twine beige', 'termite beige', 'honey brown',
        'tumbleweed', 'fawn brown', 'light earth brown', 'burnt ochre',
        'cinnamon', 'potato brown', 'tropical peach', 'burnt sienna',
        'golden brown', 'cedar brown', 'dark brown', 'russet brown',
        'brick brown', 'reddish brown', 'copper brown'
      ];
      if (skinToneNames.some(n => nameLower.includes(n))) {
        tags.push('skin-tone');
      }

      // Earth tones - browns, tans, ochres, olives
      const earthToneNames = [
        'bog mist green', 'khaki beige', 'sandbar brown', 'vandyke brown',
        'taupe brown', 'black brown', 'bark brown', 'dark bark brown',
        'madder brown', 'walnut brown', 'red bean', 'sweet rosy brown',
        'burgundy bark', 'black grape'
      ];
      if (earthToneNames.some(n => nameLower.includes(n))) {
        tags.push('earth-tone');
      }

      // Grayscale
      if (sat < 0.15) {
        tags.push('grayscale');
      }

      // Pastel (light + muted/bright)
      if (val > 0.7 && sat < 0.5) {
        tags.push('pastel');
      }

      return tags;
    }

    // Get markers filtered by tags (AND logic - all tags must match)
    function getMarkersByTags(requiredTags) {
      if (!requiredTags || requiredTags.length === 0) return markers;
      return markers.filter(m =>
        requiredTags.every(tag => m.tags && m.tags.includes(tag))
      );
    }

    // Get all available tags with counts
    function getTagCounts() {
      const counts = {};
      markers.forEach(m => {
        if (m.tags) {
          m.tags.forEach(tag => {
            counts[tag] = (counts[tag] || 0) + 1;
          });
        }
      });
      return counts;
    }

    // Load color data
    let colorData = {};
    let markers = [];

    async function loadColorData() {
      try {
        const response = await fetch('/static/data/ColorData.json');
        const result = await response.json();
        colorData = result.data;

        markers = [];
        for (const data of colorData) {
          const name = data['Color Name'];
          if (!data.Hex || name === 'Colorless Blender') continue;

          const lines = [];
          if (data.Honolulu) lines.push('Honolulu');
          if (data.Oahu) lines.push('Oahu');
          if (data.Kaala) lines.push('Kaala');

          const marker = {
            name,
            hex: data.Hex,
            code: data.New,
            lines,
            data,
            hsv: hexToHSV(data.Hex)
          };
          marker.tags = generateTags(marker);
          markers.push(marker);
        }

        return markers;
      } catch (error) {
        console.error('Error loading color data:', error);
        return [];
      }
    }
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>
